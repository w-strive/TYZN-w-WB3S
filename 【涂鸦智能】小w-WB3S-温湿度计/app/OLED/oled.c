#include "oled.h"


/* OLED显示数组 128*64 */
#ifdef OLED_GDDRAM_mode
unsigned char  OLED_GDDRAM[] =
{
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
}
;
#endif
/***************************************/


/*****************************************
 --函  数：OLED_WriteDat
 --功  能：向OLED写入一个字节数据
 --参  数：无
 --返回值：无
 --备  注：无
*****************************************/
void OLED_WriteDat(uchar dat)
{
	OLED_DC = 1;
	OLED_CS = 0;
	SPI_SendRead(dat);
	OLED_CS = 1;
}

/*****************************************
 --函  数：OLED_WriteCmd
 --功  能：向OLED写入一个字节命令
 --参  数：无
 --返回值：无
 --备  注：无
*****************************************/
void OLED_WriteCmd(uchar cmd)
{
	OLED_DC = 0;
	OLED_CS = 0;
	SPI_SendRead(cmd);
	OLED_CS = 1;
}

/*****************************************
 --函  数：OLED_Draw_Roll
 --功  能：OLED屏幕滚动
 --参  数: 无
 --返回值：无
 --备  注：水平移动指令注意：是需要写入5个字节数据，
		   有的是需要7个字节，这与手册上不太一样
*****************************************/
void OLED_Draw_Roll(bit state)
{
	OLED_WriteCmd(0x2E);	//关闭滚动
	
	if(state == 0)
	{
		return;
	}
	
//	OLED_Draw_BMP(&OLED_GDDRAM);
	
	OLED_WriteCmd(0x26);	//水平向右滚动
	OLED_WriteCmd(0x00);	//空
	OLED_WriteCmd(0x00);	//起始页地址
	OLED_WriteCmd(0x00);	//滚动时间间隔
	OLED_WriteCmd(0x01);	//结束页地址
	OLED_WriteCmd(0x00);	//起始垂直地址
	OLED_WriteCmd(0x7f);	//结束垂直地址
	
	
	OLED_WriteCmd(0x2F);	//启动滚动
}

/*****************************************
 --函  数：OLED_Init
 --功  能：OLED初始化配置
 --参  数: 无
 --返回值：无
 --备  注：SH1106
*****************************************/
void OLED_Init(void)        
{
	OLED_CS = 1;
	
	OLED_RES = 1;	//复位OLED
	Delay_ms(5);
	OLED_RES = 0;
	Delay_ms(10);
	OLED_RES = 1;
	Delay_ms(5);
	
	OLED_CS = 0;	//打开片选
	
	OLED_WriteCmd(0xae);//设置显示关
	
	//SH1106设置方案
	OLED_WriteCmd(0x02);//-设置列起始低地址(低四位有效，高四位始终为0)
	OLED_WriteCmd(0x10);//-设置列起始高地址(低四位有效，高四位始终为1)

	/*
		设置屏幕起始行(Set Display Start Line)(40h-7Fh)
		此命令用于设置屏幕起始行寄存器以设置GDDRAM起始地址, 取值范围为[0, 63]。
		若值为0, 则RAM第0行映射至COM0, 若值为1, 则RAM第1行映射到COM0, 
		以此类推
	*/	
	
	OLED_WriteCmd(0xd5);//--设置显示时钟分频值/震荡频率
	OLED_WriteCmd(0x80);//  set divide ratio, Set Clock as 100 Frames/Sec
	
	OLED_WriteCmd(0xa8);//--设置复用率(1 to 64)
	OLED_WriteCmd(0x3f);//  1/64 duty
	
	OLED_WriteCmd(0xd3);//--设置显示偏移 Shift Mapping RAM Counter (0x00~0x3F)
	OLED_WriteCmd(0x00);//  not offset
	
	OLED_WriteCmd(0x40);//--set start line address  设置映射RAM显示起始行 (0x00~0x3F)
	
	OLED_WriteCmd(0x8d);//--设置电荷泵
	OLED_WriteCmd(0x14);//  0x10关闭电荷泵   0x14打开电荷泵
	
	#ifdef OLED_Page_mode
		OLED_WriteCmd(0x20);//--设置内存地址模式 (0x00/0x01/0x02)
		OLED_WriteCmd(0x02);//  水平地址模式(A[1:0]=00b)  垂直地址模式(A[1:0]=01b)  页地址模式(A[1:0]=10b)
	#endif
	
	#ifdef OLED_GDDRAM_mode
		OLED_WriteCmd(0x20);//--设置内存地址模式 (0x00/0x01/0x02)
		OLED_WriteCmd(0x00);//  水平地址模式(A[1:0]=00b)  垂直地址模式(A[1:0]=01b)  页地址模式(A[1:0]=10b)
	#endif
	
	OLED_WriteCmd(0xa1);//-设置列扫描方向  0xa0左右反置 0xa1正常
	
	OLED_WriteCmd(0xc8);//-设置行扫描方向  0xc0上下反置 0xc8正常

	
	OLED_WriteCmd(0xda);//--设置COM指针硬件配置
	OLED_WriteCmd(0x12);//  
	
	OLED_WriteCmd(0x81);//--设置对比度 
	OLED_WriteCmd(0xcf);//  对比度的值（值越大越亮）
	
	OLED_WriteCmd(0xd9);//--设置预充电周期  此指令用于设置预充电周期的时长, 此周期单位为一DCLK的周期, 复位值为2 DCLK
	OLED_WriteCmd(0xf1);//  Set Pre-Charge as 15 Clocks & Discharge as 1 Clock
	
	OLED_WriteCmd(0xdb);//--设置VCOMH反压值(电压倍率)
	OLED_WriteCmd(0x40);//  Set VCOM Deselect Level
	
	OLED_WriteCmd(0xa4);//-全屏点亮(Entire Display ON)(A4h/A5h) 命令A4h启用输出GDDRAM中的数据 如果命令A5h已被调用, 通过A4h指令, 可以将屏幕显示从全屏点亮状态中恢复 命令A5h通过忽略GDDRAM中的数据以点亮全屏
	OLED_WriteCmd(0xa6);//-设置正常/反转显示   A6:正常  A7：反转  （正常就是写1表示亮，反转则写0为亮）
	OLED_WriteCmd(0x2e);//-禁用滚动  SH1106
	OLED_WriteCmd(0xaf);//-设置显示开
	Delay_ms(100);		 //推荐延时100ms
	
	#ifdef OLED_Page_mode
		LCD_Fill();
	#else
		OLED_Draw_BMP(&OLED_GDDRAM);	//开机清屏
	#endif
	
	OLED_CS = 1;		//关闭片选
} 






/*****************************************
 --函  数：OLED_Draw_BMP
 --功  能：OLED画图  （刷新屏幕所有点）
 --参  数: 无
 --返回值：无
 --备  注：晶振为30MHz时  刷新一帧用时大概 3.4ms
*****************************************/
void OLED_Draw_BMP(const uchar* bmp)
{ 	
	uint x;
	
	/* 设置起始位置 */
	OLED_WriteCmd(0xb0);
	OLED_WriteCmd(0x01);
	OLED_WriteCmd(0x10);
	
	
	OLED_CS = 0;	//打开片选
	OLED_DC = 1;	//写入数据
	for(x=0;x<1024;x++)
	{      
		SPI_SendRead(bmp[x]);	
	}
	OLED_CS = 1;	//关闭片选
}





/*****************************************
 --函  数：OLED_Draw_BMP_part_up
 --功  能：OLED画图  （刷新屏幕黄色部分点）
 --参  数: 无
 --返回值：无
 --备  注：晶振为30MHz时  刷新一帧用时大概 852us
*****************************************/
void OLED_Draw_BMP_part_up(const uchar* bmp)
{ 	
	uint x;
	
	/* 设置起始位置 */
	OLED_WriteCmd(0xb0);
	OLED_WriteCmd(0x01);
	OLED_WriteCmd(0x10);
	
	EX0 = 0;
	
	OLED_CS = 0;	//打开片选
	OLED_DC = 1;	//写入数据
	for(x=0;x<256;x++)		
	{      
		SPI_SendRead(bmp[x]);
	}
	OLED_CS = 1;	//关闭片选
	
	EX0 = 1;
}

/*****************************************
 --函  数：OLED_Draw_BMP_part_down
 --功  能：OLED画图  （刷新屏幕蓝色部分点）
 --参  数: 无
 --返回值：无
 --备  注：晶振为30MHz时  刷新一帧用时大概 2.553ms
*****************************************/
void OLED_Draw_BMP_part_down(const uchar* bmp)
{ 	
	uint x;
	
	/* 设置起始位置 */
	OLED_WriteCmd(0xb2);
	OLED_WriteCmd(0x01);
	OLED_WriteCmd(0x10);
	
	OLED_CS = 0;	//打开片选
	OLED_DC = 1;	//写入数据
	EX0 = 0;
	for(x=256;x<1024;x++)		//1024
	{      
		SPI_SendRead(bmp[x]);
	}
	OLED_CS = 1;	//关闭片选
	EX0 = 1;
}





/* 页模式清屏 */
void LCD_Fill(void)
{
	unsigned char y,x;
	
	for(y=0;y<8;y++)
	{
		OLED_WriteCmd(0xb0+y);
		OLED_WriteCmd(0x02);
		OLED_WriteCmd(0x10);
		for(x=0;x<128;x++)
			OLED_WriteDat(0x0);
	}
}



